# 星痕共鸣伤害统计器 - Electron版本

## 项目简介

这是星痕共鸣伤害统计器的Electron桌面应用版本，从原本的Node.js服务端应用转换而来。该版本移除了内置的Web服务器，改为使用Electron提供纯桌面应用体验。

## 版本信息

- 版本: V1.0.0 (Electron版)
- 上游内核版本: V2.8.1
- 基于: Electron 37.3.0
- Node.js: ^22.15.0

## 主要变更

### ✅ 已完成的转换

1. **架构变更**
   - 移除了Express服务器和WebSocket连接
   - 使用Electron IPC通信替代HTTP API
   - 保持所有核心功能不变

2. **文件结构调整**
   - `main.js` - Electron主进程（替代原server.js）
   - `preload.js` - 安全的渲染进程通信桥梁
   - `core/data-manager.js` - 数据管理核心逻辑
   - `core/packet-capture.js` - 网络抓包处理
   - `public/index.html` - 更新为使用IPC的前端界面

3. **功能保留**
   - ✅ 网络抓包和数据分析
   - ✅ 实时伤害/治疗统计
   - ✅ 技能分析和图表显示
   - ✅ 用户数据缓存
   - ✅ 夜间模式/简洁模式
   - ✅ 暂停/恢复统计
   - ✅ 数据清空功能

## 安装和运行

### 安装依赖

```bash
pnpm install
```

### 开发模式运行

```bash
pnpm start
```

### 调试模式运行

```bash
pnpm run dev
```

### 构建应用

```bash
pnpm run build
```

## 使用说明

### 首次启动

1. 启动应用后，点击"🎯 开始抓包"按钮
2. 在弹出的设备选择窗口中：
   - 选择网络设备（推荐使用"自动检测"）
   - 选择日志级别（Info 或 Debug）
   - 点击"开始抓包"

### 功能按钮

- **🎯 开始抓包** - 选择网络设备并开始数据抓取
- **✨ 清空统计数据** - 清除所有统计数据
- **⏸️ 暂停统计** - 暂停/恢复数据统计
- **🌙 夜间模式** - 切换深色主题
- **📋 简洁模式** - 切换简洁显示模式
- **⚙️ 用户设置** - 打开用户控制面板

### 菜单栏功能

- **文件** > 选择网络设备 - 重新选择抓包设备
- **统计** > 清除数据 - 清空统计数据
- **统计** > 暂停/恢复 - 控制统计状态
- **帮助** > 关于 - 查看应用信息

## 技术特性

### Electron架构优势

1. **无需浏览器** - 独立桌面应用，无需手动打开浏览器
2. **原生体验** - 支持系统菜单、快捷键等原生功能
3. **安全性提升** - 使用contextIsolation和preload脚本确保安全
4. **性能优化** - 直接IPC通信，无需HTTP请求开销

### 数据处理

- **实时统计** - 100ms刷新频率的实时数据更新
- **智能缓存** - 用户数据自动缓存到本地文件
- **内存优化** - 有效的数据结构和垃圾回收机制

### 网络抓包

- **自动设备检测** - 智能识别默认网络接口
- **TCP重组** - 支持分片包重组和序列化处理
- **协议解析** - 完整的游戏协议解析和数据提取

## 开发相关

### 项目结构

```
├── main.js                 # Electron主进程
├── preload.js             # 预加载脚本
├── package.json           # 项目配置
├── core/                  # 核心业务逻辑
│   ├── data-manager.js    # 数据管理
│   └── packet-capture.js  # 网络抓包
├── public/                # 前端资源
│   ├── index.html         # 主界面
│   └── echarts.min.js     # 图表库
├── algo/                  # 算法模块
│   ├── packet.js          # 数据包处理
│   ├── netInterfaceUtil.js # 网络接口工具
│   └── ...
└── skill_names.json       # 技能名称配置
```

### 关键变更说明

1. **IPC通信替代HTTP** - 所有数据交互通过Electron IPC完成
2. **设备选择界面** - 动态生成HTML的模态窗口
3. **菜单集成** - 应用菜单提供便捷功能访问
4. **状态管理** - 统一的状态管理和数据同步

### 依赖变更

**移除的依赖：**
- express
- socket.io
- cors

**新增的依赖：**
- electron
- electron-builder

## 注意事项

1. **管理员权限** - 网络抓包功能可能需要管理员权限
2. **防火墙设置** - 确保防火墙允许应用访问网络接口
3. **游戏兼容性** - 请确保游戏版本与解析协议兼容
4. **性能监控** - 长时间运行建议定期重启应用

## 问题排查

### 常见问题

1. **无法开始抓包**
   - 检查是否有管理员权限
   - 尝试选择不同的网络设备
   - 查看控制台错误信息

2. **数据不显示**
   - 确认游戏是否正在运行
   - 检查网络设备选择是否正确
   - 验证防火墙设置

3. **应用崩溃**
   - 查看日志输出
   - 尝试调试模式运行
   - 检查Node.js版本兼容性

## 许可证

AGPL-3.0

## 上游作者

Dimole <dmlgzs@qq.com>

## 上游项目地址

GitHub: https://github.com/dmlgzs/StarResonanceDamageCounter
