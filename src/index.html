<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊòüÁóïÂÖ±È∏£ DPS ÁªüËÆ°Â∑•ÂÖ∑</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="app">
        <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
        <nav class="navbar">
            <div class="navbar-brand">
                <div class="brand-icon">‚ö°</div>
                <div class="brand-text">
                    <h1>ÊòüÁóïÂÖ±È∏£ DPS</h1>
                    <span class="brand-subtitle">ÂÆûÊó∂‰º§ÂÆ≥ÁªüËÆ°ÂàÜÊûêÂ∑•ÂÖ∑</span>
                </div>
            </div>
            
            <div class="navbar-center">
                <div class="status-card" id="statusCard">
                    <div class="status-indicator" id="statusIndicator">
                        <div class="status-dot"></div>
                        <span class="status-text">ÂæÖËøûÊé•</span>
                    </div>
                    <div class="status-info">
                        <div class="status-detail">
                            <span class="label">ËÆæÂ§á</span>
                            <span class="value" id="currentDevice">Êú™ÈÄâÊã©</span>
                        </div>
                        <div class="status-detail">
                            <span class="label">Áé©ÂÆ∂</span>
                            <span class="value" id="playerUid">Êú™Ê£ÄÊµã</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="window-controls">
                <button class="window-control-btn minimize-btn" id="minimizeBtn" title="ÊúÄÂ∞èÂåñ">
                    <span>‚Äì</span>
                </button>
                <button class="window-control-btn maximize-btn" id="maximizeBtn" title="ÊúÄÂ§ßÂåñ">
                    <span>‚ñ°</span>
                </button>
                <button class="window-control-btn close-btn" id="closeBtn" title="ÂÖ≥Èó≠">
                    <span>‚úï</span>
                </button>
            </div>
        </nav>

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
        <main class="main-container">
            <!-- ÊéßÂà∂Èù¢Êùø -->
            <section class="control-section">
                <div class="control-card">
                    <div class="card-header">
                        <h3>ËøûÊé•ÊéßÂà∂</h3>
                    </div>
                    <div class="card-content">
                        <div class="control-row">
                            <div class="control-group">
                                <label for="deviceSelect" class="control-label">
                                    <span class="label-icon">üîó</span>
                                    ÁΩëÁªúËÆæÂ§á
                                </label>
                                <select id="deviceSelect" class="device-select" disabled>
                                    <option value="">Ê≠£Âú®Âä†ËΩΩËÆæÂ§á...</option>
                                </select>
                            </div>
                            <div class="control-actions">
                                <button id="refreshDeviceBtn" class="btn btn-outline" title="Âà∑Êñ∞ËÆæÂ§áÂàóË°®">
                                    <span class="btn-icon">üîÑ</span>
                                    Âà∑Êñ∞
                                </button>
                                <button id="startCaptureBtn" class="btn btn-success" disabled>
                                    <span class="btn-icon">‚ñ∂Ô∏è</span>
                                    ÂºÄÂßãÊäìÂåÖ
                                </button>
                                <button id="stopCaptureBtn" class="btn btn-danger" disabled>
                                    <span class="btn-icon">‚èπÔ∏è</span>
                                    ÂÅúÊ≠¢ÊäìÂåÖ
                                </button>
                                <button id="clearStatsBtn" class="btn btn-warning">
                                    <span class="btn-icon">üóëÔ∏è</span>
                                    Ê∏ÖÈô§Êï∞ÊçÆ
                                </button>
                                <button id="showLogBtn" class="btn btn-outline">
                                    <span class="btn-icon">üìù</span>
                                    Êó•ÂøóÁ™óÂè£
                                </button>
                                <button id="toggleOverlayBtn" class="btn btn-outline">
                                    <span class="btn-icon">üì±</span>
                                    <span class="btn-text">ÊÇ¨ÊµÆÁ™ó</span>
                                </button>
                                <button id="toggleRankingOverlayBtn" class="btn btn-outline">
                                    <span class="btn-icon">üèÜ</span>
                                    <span class="btn-text">DPSÊéíË°åÊ¶ú</span>
                                </button>
                                <button id="toggleSelfOnlyBtn" class="btn btn-outline">
                                    <span class="btn-info">Ê®°ÂºèÔºö</span>
                                    <span class="btn-text">üëªË∞ÅÊòØÂÜÖÈ¨º</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Êï∞ÊçÆÂ±ïÁ§∫Âå∫Âüü -->
            <section class="data-section">
                <!-- Á©∫Áä∂ÊÄÅ -->
                <div class="empty-state" id="noDataMessage">
                    <div class="empty-icon">
                        <div class="pulse-ring"></div>
                        <div class="pulse-icon">üìä</div>
                    </div>
                    <h3>Á≠âÂæÖÊï∞ÊçÆ‰∏≠...</h3>
                    <p>ËØ∑ÈÄâÊã©ÁΩëÁªúËÆæÂ§áÂπ∂ÂºÄÂßãÊï∞ÊçÆÊçïËé∑</p>
                    <div class="empty-actions">
                        <button class="btn btn-primary" onclick="document.getElementById('refreshDeviceBtn').click()">
                            Âà∑Êñ∞ËÆæÂ§áÂàóË°®
                        </button>
                    </div>
                </div>

                <!-- ÁªüËÆ°Êï∞ÊçÆÂÆπÂô® -->
                <div class="stats-container" id="statsContainer" style="display: none;">
                    <!-- Ê¶ÇËßà‰ª™Ë°®Êùø -->
                    <div class="dashboard">
                        <div class="metric-card primary" id="realtimeDpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">‚ö°</div>
                                <div class="metric-info">
                                    <h4>ÂÆûÊó∂ DPS</h4>
                                    <span class="metric-subtitle">ÂΩìÂâçÊØèÁßí‰º§ÂÆ≥</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalRealtimeDps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card danger" id="maxDpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">üî•</div>
                                <div class="metric-info">
                                    <h4>Â≥∞ÂÄº DPS</h4>
                                    <span class="metric-subtitle">ÂéÜÂè≤ÊúÄÈ´ò</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalMaxDps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card success" id="avgDpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">üìà</div>
                                <div class="metric-info">
                                    <h4>Âπ≥Âùá DPS</h4>
                                    <span class="metric-subtitle">ÊÄª‰ΩìÂπ≥Âùá</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalAvgDps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card warning" id="totalDamageCard">
                            <div class="metric-header">
                                <div class="metric-icon">üí•</div>
                                <div class="metric-info">
                                    <h4>ÊÄª‰º§ÂÆ≥</h4>
                                    <span class="metric-subtitle">Á¥ØËÆ°ÈÄ†Êàê</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalDamage">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card primary" id="realtimeHpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">üíö</div>
                                <div class="metric-info">
                                    <h4>ÂÆûÊó∂ HPS</h4>
                                    <span class="metric-subtitle">ÂΩìÂâçÊØèÁßíÊ≤ªÁñó</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalRealtimeHps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card danger" id="maxHpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">üåü</div>
                                <div class="metric-info">
                                    <h4>Â≥∞ÂÄº HPS</h4>
                                    <span class="metric-subtitle">ÂéÜÂè≤ÊúÄÈ´ò</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalMaxHps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card success" id="avgHpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">üìä</div>
                                <div class="metric-info">
                                    <h4>Âπ≥Âùá HPS</h4>
                                    <span class="metric-subtitle">ÊÄª‰ΩìÂπ≥Âùá</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalAvgHps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card warning" id="totalHealingCard">
                            <div class="metric-header">
                                <div class="metric-icon">üíñ</div>
                                <div class="metric-info">
                                    <h4>ÊÄªÊ≤ªÁñó</h4>
                                    <span class="metric-subtitle">Á¥ØËÆ°Ê≤ªÁñó</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalHealing">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ËØ¶ÁªÜÊï∞ÊçÆË°®Ê†º -->
                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>ËØ¶ÁªÜÁªüËÆ°</h3>
                            <div class="table-controls">
                                <button class="btn btn-sm btn-primary" id="showDetailBtn" disabled>
                                    <span class="btn-icon">üìä</span>
                                    Êü•ÁúãËØ¶ÁªÜ‰ø°ÊÅØ
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-wrapper">
                            <table class="data-table" id="statsTable">
                                <thead>
                                    <tr>
                                        <th class="sortable" data-sort="uid">
                                            <span>Áé©ÂÆ∂</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th class="sortable" data-sort="role">
                                            <span>ËÅå‰∏ö</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th class="sortable" data-sort="fightpoint">
                                            <span>ÊàòÂäõ</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th class="sortable" data-sort="realtime">
                                            <span>ÂÆûÊó∂ DPS</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th class="sortable" data-sort="max">
                                            <span>Â≥∞ÂÄº DPS</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th class="sortable" data-sort="avg">
                                            <span>Âπ≥Âùá DPS</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th class="sortable" data-sort="total">
                                            <span>ÊÄª‰º§ÂÆ≥</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th>ÊôÆÈÄö</th>
                                        <th>Êö¥Âáª</th>
                                        <th>Âπ∏Ëøê</th>
                                        <th>Êö¥ÂáªÂπ∏Ëøê</th>
                                        <th>Ê¨°Êï∞</th>
                                        <th class="sortable" data-sort="crit-rate">
                                            <span>Êö¥ÂáªÁéá</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th class="sortable" data-sort="realtime-hps">
                                            <span>ÂÆûÊó∂ HPS</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th class="sortable" data-sort="max-hps">
                                            <span>Â≥∞ÂÄº HPS</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th class="sortable" data-sort="avg-hps">
                                            <span>Âπ≥Âùá HPS</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th class="sortable" data-sort="total-healing">
                                            <span>ÊÄªÊ≤ªÁñó</span>
                                            <span class="sort-icon">‚ÜïÔ∏è</span>
                                        </th>
                                        <th>Ê≤ªÁñóÊôÆÈÄö</th>
                                        <th>Ê≤ªÁñóÊö¥Âáª</th>
                                        <th>Ê≤ªÁñóÂπ∏Ëøê</th>
                                        <th>Ê≤ªÁñóÊö¥ÂáªÂπ∏Ëøê</th>
                            <th>Ê≤ªÁñóÊ¨°Êï∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Âä®ÊÄÅÂ°´ÂÖÖÊï∞ÊçÆ -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Áî®Êà∑ËØ¶ÁªÜÂàÜÊûêÂºπÁ™ó -->
    <div class="modal-overlay" id="userDetailModal" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Áî®Êà∑ËØ¶ÁªÜÂàÜÊûê</h3>
                <div class="user-selector">
                    <label>ÂàáÊç¢Áî®Êà∑Ôºö</label>
                    <select id="userDetailSelect" class="user-select">
                        <!-- Âä®ÊÄÅÂ°´ÂÖÖÁî®Êà∑ÂàóË°® -->
                    </select>
                </div>
                <button class="modal-close" id="closeUserDetailModal">‚úï</button>
            </div>
            
            <div class="modal-content">
                <!-- Áî®Êà∑Âü∫Êú¨‰ø°ÊÅØ -->
                <div class="user-info-section">
                    <div class="user-info-card">
                        <div class="user-avatar">
                            <span class="user-icon">üë§</span>
                        </div>
                        <div class="user-details">
                            <h4 id="selectedUserUid">Áî®Êà∑ UID</h4>
                            <p id="selectedUserRole">ËÅå‰∏ö</p>
                        </div>
                        <div class="user-stats-summary">
                            <div class="summary-item">
                                <span class="summary-label">ÊÄª‰º§ÂÆ≥</span>
                                <span class="summary-value" id="userTotalDamage">0</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">ÊÄªÊ≤ªÁñó</span>
                                <span class="summary-value" id="userTotalHealing">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Êï∞ÊçÆÁ±ªÂûãÂàáÊç¢Ê†áÁ≠æ -->
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-button active" data-tab="damage">‰º§ÂÆ≥ÂàÜÊûê</button>
                        <button class="tab-button" data-tab="healing">Ê≤ªÁñóÂàÜÊûê</button>
                    </div>
                </div>

                <!-- ‰º§ÂÆ≥ÂàÜÊûêÊ†áÁ≠æÈ°µ -->
                <div class="tab-content active" id="damageTab">
                    <div class="analysis-grid">
                        <!-- ÊäÄËÉΩ‰º§ÂÆ≥Âç†ÊØîÂõæË°® -->
                        <div class="analysis-card">
                            <h5>ÊäÄËÉΩ‰º§ÂÆ≥Âç†ÊØî</h5>
                            <div class="skill-chart" id="damageSkillChart">
                                <!-- Âä®ÊÄÅÁîüÊàêÊäÄËÉΩÂç†ÊØîÊù°ÂΩ¢Âõæ -->
                            </div>
                        </div>

                        <!-- ‰º§ÂÆ≥ÁªüËÆ°Ë°®Ê†º -->
                        <div class="analysis-card">
                            <h5>ÊäÄËÉΩËØ¶ÁªÜÁªüËÆ°</h5>
                            <div class="skill-table-wrapper">
                                <table class="skill-table">
                                    <thead>
                                        <tr>
                                            <th>ÊäÄËÉΩID</th>
                                            <th>ÊÄª‰º§ÂÆ≥</th>
                                            <th>Âç†ÊØî</th>
                                            <th>Ê¨°Êï∞</th>
                                            <th>Âπ≥Âùá‰º§ÂÆ≥</th>
                                            <th>ÊúÄÈ´ò‰º§ÂÆ≥</th>
                                            <th>Êö¥ÂáªÁéá</th>
                                            <th>Âπ∏ËøêÁéá</th>
                                        </tr>
                                    </thead>
                                    <tbody id="damageSkillTableBody">
                                        <!-- Âä®ÊÄÅÂ°´ÂÖÖÊäÄËÉΩÊï∞ÊçÆ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- ‰º§ÂÆ≥Á±ªÂûãÂàÜÂ∏É -->
                        <div class="analysis-card">
                            <h5>‰º§ÂÆ≥Á±ªÂûãÂàÜÂ∏É</h5>
                            <div class="damage-type-chart">
                                <div class="damage-type-item">
                                    <span class="type-label">ÊôÆÈÄö‰º§ÂÆ≥</span>
                                    <div class="type-bar">
                                        <div class="type-fill normal" id="normalDamageBar"></div>
                                    </div>
                                    <span class="type-value" id="normalDamageValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">Êö¥Âáª‰º§ÂÆ≥</span>
                                    <div class="type-bar">
                                        <div class="type-fill critical" id="criticalDamageBar"></div>
                                    </div>
                                    <span class="type-value" id="criticalDamageValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">Âπ∏Ëøê‰º§ÂÆ≥</span>
                                    <div class="type-bar">
                                        <div class="type-fill lucky" id="luckyDamageBar"></div>
                                    </div>
                                    <span class="type-value" id="luckyDamageValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">Êö¥ÂáªÂπ∏Ëøê</span>
                                    <div class="type-bar">
                                        <div class="type-fill crit-lucky" id="critLuckyDamageBar"></div>
                                    </div>
                                    <span class="type-value" id="critLuckyDamageValue">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ê≤ªÁñóÂàÜÊûêÊ†áÁ≠æÈ°µ -->
                <div class="tab-content" id="healingTab">
                    <div class="analysis-grid">
                        <!-- ÊäÄËÉΩÊ≤ªÁñóÂç†ÊØîÂõæË°® -->
                        <div class="analysis-card">
                            <h5>ÊäÄËÉΩÊ≤ªÁñóÂç†ÊØî</h5>
                            <div class="skill-chart" id="healingSkillChart">
                                <!-- Âä®ÊÄÅÁîüÊàêÊäÄËÉΩÂç†ÊØîÊù°ÂΩ¢Âõæ -->
                            </div>
                        </div>

                        <!-- Ê≤ªÁñóÁªüËÆ°Ë°®Ê†º -->
                        <div class="analysis-card">
                            <h5>ÊäÄËÉΩËØ¶ÁªÜÁªüËÆ°</h5>
                            <div class="skill-table-wrapper">
                                <table class="skill-table">
                                    <thead>
                                        <tr>
                                            <th>ÊäÄËÉΩID</th>
                                            <th>ÊÄªÊ≤ªÁñó</th>
                                            <th>Âç†ÊØî</th>
                                            <th>Ê¨°Êï∞</th>
                                            <th>Âπ≥ÂùáÊ≤ªÁñó</th>
                                            <th>ÊúÄÈ´òÊ≤ªÁñó</th>
                                            <th>Êö¥ÂáªÁéá</th>
                                            <th>Âπ∏ËøêÁéá</th>
                                        </tr>
                                    </thead>
                                    <tbody id="healingSkillTableBody">
                                        <!-- Âä®ÊÄÅÂ°´ÂÖÖÊäÄËÉΩÊï∞ÊçÆ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Ê≤ªÁñóÁ±ªÂûãÂàÜÂ∏É -->
                        <div class="analysis-card">
                            <h5>Ê≤ªÁñóÁ±ªÂûãÂàÜÂ∏É</h5>
                            <div class="damage-type-chart">
                                <div class="damage-type-item">
                                    <span class="type-label">ÊôÆÈÄöÊ≤ªÁñó</span>
                                    <div class="type-bar">
                                        <div class="type-fill normal" id="normalHealingBar"></div>
                                    </div>
                                    <span class="type-value" id="normalHealingValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">Êö¥ÂáªÊ≤ªÁñó</span>
                                    <div class="type-bar">
                                        <div class="type-fill critical" id="criticalHealingBar"></div>
                                    </div>
                                    <span class="type-value" id="criticalHealingValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">Âπ∏ËøêÊ≤ªÁñó</span>
                                    <div class="type-bar">
                                        <div class="type-fill lucky" id="luckyHealingBar"></div>
                                    </div>
                                    <span class="type-value" id="luckyHealingValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">Êö¥ÂáªÂπ∏Ëøê</span>
                                    <div class="type-bar">
                                        <div class="type-fill crit-lucky" id="critLuckyHealingBar"></div>
                                    </div>
                                    <span class="type-value" id="critLuckyHealingValue">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Á°ÆËÆ§ÂºπÁ™ó -->
    <div id="confirmDialog" class="confirm-dialog-overlay">
        <div class="confirm-dialog">
            <div class="confirm-dialog-icon">
                ‚ö†Ô∏è
            </div>
            <h3 class="confirm-dialog-title">Á°ÆËÆ§Êìç‰Ωú</h3>
            <p class="confirm-dialog-message">Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÁªüËÆ°Êï∞ÊçÆÂêóÔºüÊ≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ</p>
            <div class="confirm-dialog-actions">
                <button class="confirm-dialog-btn confirm-dialog-btn-cancel" id="confirmCancel">ÂèñÊ∂à</button>
                <button class="confirm-dialog-btn confirm-dialog-btn-confirm" id="confirmOk">Á°ÆËÆ§Ê∏ÖÈô§</button>
            </div>
        </div>
    </div>

    <script src="renderer.js"></script>
</body>
</html>