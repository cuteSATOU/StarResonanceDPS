<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星痕共鸣 DPS 统计工具</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="app">
        <!-- 顶部导航栏 -->
        <nav class="navbar">
            <div class="navbar-brand">
                <div class="brand-icon">⚡</div>
                <div class="brand-text">
                    <h1>星痕共鸣 DPS</h1>
                    <span class="brand-subtitle">实时伤害统计分析工具</span>
                </div>
            </div>
            
            <div class="navbar-center">
                <div class="status-card" id="statusCard">
                    <div class="status-indicator" id="statusIndicator">
                        <div class="status-dot"></div>
                        <span class="status-text">待连接</span>
                    </div>
                    <div class="status-info">
                        <div class="status-detail">
                            <span class="label">设备</span>
                            <span class="value" id="currentDevice">未选择</span>
                        </div>
                        <div class="status-detail">
                            <span class="label">玩家</span>
                            <span class="value" id="playerUid">未检测</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="window-controls">
                <button class="window-control-btn minimize-btn" id="minimizeBtn" title="最小化">
                    <span>–</span>
                </button>
                <button class="window-control-btn maximize-btn" id="maximizeBtn" title="最大化">
                    <span>□</span>
                </button>
                <button class="window-control-btn close-btn" id="closeBtn" title="关闭">
                    <span>✕</span>
                </button>
            </div>
        </nav>

        <!-- 主要内容区域 -->
        <main class="main-container">
            <!-- 控制面板 -->
            <section class="control-section">
                <div class="control-card">
                    <div class="card-header">
                        <h3>连接控制</h3>
                    </div>
                    <div class="card-content">
                        <div class="control-row">
                            <div class="control-group">
                                <label for="deviceSelect" class="control-label">
                                    <span class="label-icon">🔗</span>
                                    网络设备
                                </label>
                                <select id="deviceSelect" class="device-select" disabled>
                                    <option value="">正在加载设备...</option>
                                </select>
                            </div>
                            <div class="control-actions">
                                <button id="refreshDeviceBtn" class="btn btn-outline" title="刷新设备列表">
                                    <span class="btn-icon">🔄</span>
                                    刷新
                                </button>
                                <button id="startCaptureBtn" class="btn btn-success" disabled>
                                    <span class="btn-icon">▶️</span>
                                    开始抓包
                                </button>
                                <button id="stopCaptureBtn" class="btn btn-danger" disabled>
                                    <span class="btn-icon">⏹️</span>
                                    停止抓包
                                </button>
                                <button id="clearStatsBtn" class="btn btn-warning">
                                    <span class="btn-icon">🗑️</span>
                                    清除数据
                                </button>
                                <button id="showLogBtn" class="btn btn-outline">
                                    <span class="btn-icon">📝</span>
                                    日志窗口
                                </button>
                                <button id="toggleOverlayBtn" class="btn btn-outline">
                                    <span class="btn-icon">📱</span>
                                    <span class="btn-text">悬浮窗</span>
                                </button>
                                <button id="toggleRankingOverlayBtn" class="btn btn-outline">
                                    <span class="btn-icon">🏆</span>
                                    <span class="btn-text">DPS排行榜</span>
                                </button>
                                <button id="toggleSelfOnlyBtn" class="btn btn-outline">
                                    <span class="btn-info">模式：</span>
                                    <span class="btn-text">👻谁是内鬼</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 数据展示区域 -->
            <section class="data-section">
                <!-- 空状态 -->
                <div class="empty-state" id="noDataMessage">
                    <div class="empty-icon">
                        <div class="pulse-ring"></div>
                        <div class="pulse-icon">📊</div>
                    </div>
                    <h3>等待数据中...</h3>
                    <p>请选择网络设备并开始数据捕获</p>
                    <div class="empty-actions">
                        <button class="btn btn-primary" onclick="document.getElementById('refreshDeviceBtn').click()">
                            刷新设备列表
                        </button>
                    </div>
                </div>

                <!-- 统计数据容器 -->
                <div class="stats-container" id="statsContainer" style="display: none;">
                    <!-- 概览仪表板 -->
                    <div class="dashboard">
                        <div class="metric-card primary" id="realtimeDpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">⚡</div>
                                <div class="metric-info">
                                    <h4>实时 DPS</h4>
                                    <span class="metric-subtitle">当前每秒伤害</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalRealtimeDps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card danger" id="maxDpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">🔥</div>
                                <div class="metric-info">
                                    <h4>峰值 DPS</h4>
                                    <span class="metric-subtitle">历史最高</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalMaxDps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card success" id="avgDpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">📈</div>
                                <div class="metric-info">
                                    <h4>平均 DPS</h4>
                                    <span class="metric-subtitle">总体平均</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalAvgDps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card warning" id="totalDamageCard">
                            <div class="metric-header">
                                <div class="metric-icon">💥</div>
                                <div class="metric-info">
                                    <h4>总伤害</h4>
                                    <span class="metric-subtitle">累计造成</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalDamage">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card primary" id="realtimeHpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">💚</div>
                                <div class="metric-info">
                                    <h4>实时 HPS</h4>
                                    <span class="metric-subtitle">当前每秒治疗</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalRealtimeHps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card danger" id="maxHpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">🌟</div>
                                <div class="metric-info">
                                    <h4>峰值 HPS</h4>
                                    <span class="metric-subtitle">历史最高</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalMaxHps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card success" id="avgHpsCard">
                            <div class="metric-header">
                                <div class="metric-icon">📊</div>
                                <div class="metric-info">
                                    <h4>平均 HPS</h4>
                                    <span class="metric-subtitle">总体平均</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalAvgHps">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="metric-card warning" id="totalHealingCard">
                            <div class="metric-header">
                                <div class="metric-icon">💖</div>
                                <div class="metric-info">
                                    <h4>总治疗</h4>
                                    <span class="metric-subtitle">累计治疗</span>
                                </div>
                            </div>
                            <div class="metric-value" id="totalHealing">0</div>
                            <div class="metric-chart">
                                <div class="chart-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 详细数据表格 -->
                    <div class="data-table-container">
                        <div class="table-header">
                            <h3>详细统计</h3>
                            <div class="table-controls">
                                <button class="btn btn-sm btn-primary" id="showDetailBtn" disabled>
                                    <span class="btn-icon">📊</span>
                                    查看详细信息
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-wrapper">
                            <table class="data-table" id="statsTable">
                                <thead>
                                    <tr>
                                        <th class="sortable" data-sort="uid">
                                            <span>玩家</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th class="sortable" data-sort="role">
                                            <span>职业</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th class="sortable" data-sort="fightpoint">
                                            <span>战力</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th class="sortable" data-sort="realtime">
                                            <span>实时 DPS</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th class="sortable" data-sort="max">
                                            <span>峰值 DPS</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th class="sortable" data-sort="avg">
                                            <span>平均 DPS</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th class="sortable" data-sort="total">
                                            <span>总伤害</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th>普通</th>
                                        <th>暴击</th>
                                        <th>幸运</th>
                                        <th>暴击幸运</th>
                                        <th>次数</th>
                                        <th class="sortable" data-sort="crit-rate">
                                            <span>暴击率</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th class="sortable" data-sort="realtime-hps">
                                            <span>实时 HPS</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th class="sortable" data-sort="max-hps">
                                            <span>峰值 HPS</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th class="sortable" data-sort="avg-hps">
                                            <span>平均 HPS</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th class="sortable" data-sort="total-healing">
                                            <span>总治疗</span>
                                            <span class="sort-icon">↕️</span>
                                        </th>
                                        <th>治疗普通</th>
                                        <th>治疗暴击</th>
                                        <th>治疗幸运</th>
                                        <th>治疗暴击幸运</th>
                            <th>治疗次数</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 动态填充数据 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 用户详细分析弹窗 -->
    <div class="modal-overlay" id="userDetailModal" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h3>用户详细分析</h3>
                <div class="user-selector">
                    <label>切换用户：</label>
                    <select id="userDetailSelect" class="user-select">
                        <!-- 动态填充用户列表 -->
                    </select>
                </div>
                <button class="modal-close" id="closeUserDetailModal">✕</button>
            </div>
            
            <div class="modal-content">
                <!-- 用户基本信息 -->
                <div class="user-info-section">
                    <div class="user-info-card">
                        <div class="user-avatar">
                            <span class="user-icon">👤</span>
                        </div>
                        <div class="user-details">
                            <h4 id="selectedUserUid">用户 UID</h4>
                            <p id="selectedUserRole">职业</p>
                        </div>
                        <div class="user-stats-summary">
                            <div class="summary-item">
                                <span class="summary-label">总伤害</span>
                                <span class="summary-value" id="userTotalDamage">0</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">总治疗</span>
                                <span class="summary-value" id="userTotalHealing">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 数据类型切换标签 -->
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-button active" data-tab="damage">伤害分析</button>
                        <button class="tab-button" data-tab="healing">治疗分析</button>
                    </div>
                </div>

                <!-- 伤害分析标签页 -->
                <div class="tab-content active" id="damageTab">
                    <div class="analysis-grid">
                        <!-- 技能伤害占比图表 -->
                        <div class="analysis-card">
                            <h5>技能伤害占比</h5>
                            <div class="skill-chart" id="damageSkillChart">
                                <!-- 动态生成技能占比条形图 -->
                            </div>
                        </div>

                        <!-- 伤害统计表格 -->
                        <div class="analysis-card">
                            <h5>技能详细统计</h5>
                            <div class="skill-table-wrapper">
                                <table class="skill-table">
                                    <thead>
                                        <tr>
                                            <th>技能ID</th>
                                            <th>总伤害</th>
                                            <th>占比</th>
                                            <th>次数</th>
                                            <th>平均伤害</th>
                                            <th>最高伤害</th>
                                            <th>暴击率</th>
                                            <th>幸运率</th>
                                        </tr>
                                    </thead>
                                    <tbody id="damageSkillTableBody">
                                        <!-- 动态填充技能数据 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 伤害类型分布 -->
                        <div class="analysis-card">
                            <h5>伤害类型分布</h5>
                            <div class="damage-type-chart">
                                <div class="damage-type-item">
                                    <span class="type-label">普通伤害</span>
                                    <div class="type-bar">
                                        <div class="type-fill normal" id="normalDamageBar"></div>
                                    </div>
                                    <span class="type-value" id="normalDamageValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">暴击伤害</span>
                                    <div class="type-bar">
                                        <div class="type-fill critical" id="criticalDamageBar"></div>
                                    </div>
                                    <span class="type-value" id="criticalDamageValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">幸运伤害</span>
                                    <div class="type-bar">
                                        <div class="type-fill lucky" id="luckyDamageBar"></div>
                                    </div>
                                    <span class="type-value" id="luckyDamageValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">暴击幸运</span>
                                    <div class="type-bar">
                                        <div class="type-fill crit-lucky" id="critLuckyDamageBar"></div>
                                    </div>
                                    <span class="type-value" id="critLuckyDamageValue">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 治疗分析标签页 -->
                <div class="tab-content" id="healingTab">
                    <div class="analysis-grid">
                        <!-- 技能治疗占比图表 -->
                        <div class="analysis-card">
                            <h5>技能治疗占比</h5>
                            <div class="skill-chart" id="healingSkillChart">
                                <!-- 动态生成技能占比条形图 -->
                            </div>
                        </div>

                        <!-- 治疗统计表格 -->
                        <div class="analysis-card">
                            <h5>技能详细统计</h5>
                            <div class="skill-table-wrapper">
                                <table class="skill-table">
                                    <thead>
                                        <tr>
                                            <th>技能ID</th>
                                            <th>总治疗</th>
                                            <th>占比</th>
                                            <th>次数</th>
                                            <th>平均治疗</th>
                                            <th>最高治疗</th>
                                            <th>暴击率</th>
                                            <th>幸运率</th>
                                        </tr>
                                    </thead>
                                    <tbody id="healingSkillTableBody">
                                        <!-- 动态填充技能数据 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 治疗类型分布 -->
                        <div class="analysis-card">
                            <h5>治疗类型分布</h5>
                            <div class="damage-type-chart">
                                <div class="damage-type-item">
                                    <span class="type-label">普通治疗</span>
                                    <div class="type-bar">
                                        <div class="type-fill normal" id="normalHealingBar"></div>
                                    </div>
                                    <span class="type-value" id="normalHealingValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">暴击治疗</span>
                                    <div class="type-bar">
                                        <div class="type-fill critical" id="criticalHealingBar"></div>
                                    </div>
                                    <span class="type-value" id="criticalHealingValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">幸运治疗</span>
                                    <div class="type-bar">
                                        <div class="type-fill lucky" id="luckyHealingBar"></div>
                                    </div>
                                    <span class="type-value" id="luckyHealingValue">0</span>
                                </div>
                                <div class="damage-type-item">
                                    <span class="type-label">暴击幸运</span>
                                    <div class="type-bar">
                                        <div class="type-fill crit-lucky" id="critLuckyHealingBar"></div>
                                    </div>
                                    <span class="type-value" id="critLuckyHealingValue">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 确认弹窗 -->
    <div id="confirmDialog" class="confirm-dialog-overlay">
        <div class="confirm-dialog">
            <div class="confirm-dialog-icon">
                ⚠️
            </div>
            <h3 class="confirm-dialog-title">确认操作</h3>
            <p class="confirm-dialog-message">确定要清除所有统计数据吗？此操作无法撤销。</p>
            <div class="confirm-dialog-actions">
                <button class="confirm-dialog-btn confirm-dialog-btn-cancel" id="confirmCancel">取消</button>
                <button class="confirm-dialog-btn confirm-dialog-btn-confirm" id="confirmOk">确认清除</button>
            </div>
        </div>
    </div>

    <script src="renderer.js"></script>
</body>
</html>